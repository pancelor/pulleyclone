<HTML>
	<HEAD>
	<Title>"2-2"</TITLE>
	<!-- ALL functions and
		all classes either imported-
		or implented Here-->
	<script src="actor.js"></script>
	<script>

		(function() {
		  var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
		    window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
		  window.requestAnimationFrame = requestAnimationFrame;
		})();

		window.addEventListener("keyup", onKeyUp);

		        function onKeyUp(event) {
		          switch (event.key) {
		            case "d":
		              updateStuff(1, 0);
		              break;
		            case "s":
		              updateStuff(0, 1);
		              break;
		            case "a":
		              updateStuff(-1, 0);
		              break;
		            case "w":
		              updateStuff(0, -1);
		              break;
		          }
		        }

		function drawBackground(canvas, ctx)
			{
				const img = document.getElementById("grass");
            	var ptrn = ctx.createPattern(img, 'repeat');
	            ctx.fillStyle = ptrn;
	            ctx.fillRect(0, 0, canvas.width, canvas.height);
	            ctx.fillStyle = undefined;
			}

		function updateStuff(playerdX,playerdY) {
			// TODO: loop over the all actors and call update() on each one.
			for (var i=0; i < allActors.length; i++){
				//console.log(i);
				allActors[i].update(playerdX,playerdY);
			}
		}

		function drawStuff() {
		  var c = document.getElementById("myCanvas");
		  var ctx = c.getContext("2d");
		  drawBackground(c, ctx);

		  for (var i=0; i < allActors.length; i++){
		  	allActors[i].draw(ctx);
		  }
		  for (var i=0; i < allObstacles.length; i++){
		  	allObstacles[i].draw(ctx);
		  }
		  for (var i=0; i < allPotions.length; i++){
		  	allPotions[i].draw(ctx);
		  }

		  window.requestAnimationFrame(drawStuff);
		}

		function initGame() {
			// TODO: loop over mapArray and create an Actor for each tile.
			// each actor will get it's `x`, `y`, and `sprite` variables set

			const mapping = {
		    0: "grass",
		    1: "dirt",
		    2: "tree",
		    3: "brick",
		    4: "mountains",
		    5: "potion",
		    6: "slime",
		    7: "hero",
			}

			allActors = [];
			allObstacles = [];
			allPotions = [];

			for (var i=0; i < mapArray.length; i++){
                for (var j=0; j < mapArray[i].length; j++){
                    const type = mapping[mapArray[i][j]]
                    if (type == "tree" || type == "mountains" || type == "brick") {
                        allObstacles.push(new obstacle(j, i, type));
                    }
                    if (type == "hero" || type == "slime") {
                        allActors.push(new actor(j, i, type));
                    }
                    if (type == "potion") {
                        allPotions.push(new actor(j, i, type));
                    }
                }
            }


			//console.log(allActors);
			//console.log(allActors[20]);
			//actors map is
			//0-9
			//10-19
			//20-29 etc

			window.requestAnimationFrame(drawStuff);
		}

	</script>

	</HEAD>
	<BODY>

		<IMG src="grass.png" alt="grass" style="display:none;" id="grass"/>
		<IMG src="dirt.png" alt="dirt" style="display:none;" id="dirt"/>
		<IMG src="tree.png" alt="tree" style="display:none;" id="tree"/>
		<IMG src="bricks.png" alt="brick" style="display:none;" id="brick"/>
		<IMG src="mountains.png" alt="mountains" style="display:none;" id="mountains"/>
		<IMG src="potion.png" alt="potion" style="display:none;" id="potion"/>
		<IMG src="slime.png" alt="slime" style="display:none;" id="slime"/>
		<IMG src="hero.png" alt="hero" style="display:none;" id="hero"/>

		<button type="button" id="myBtn" onclick="initGame()">Play!</button>
		<br> <br>
		<SECTION id="canvas">

			<CANVAS width=640 height=640 id="myCanvas" style="border: 1px solid black; border-radius: 5px;">
				Your Web-Browser does not support Canvas

		</SECTION>
		<section id="console">
		</section>

		<script>

		//global variables
		var allActors;
		var allObstacles;
		var allPotions;

		var mapArray=[
			[4,4,4,4,4,4,4,4,4,4],
			[7,0,0,0,0,0,0,6,2,2],
			[2,0,2,2,0,2,2,0,3,3],
			[2,0,0,0,6,0,0,0,2,5],
			[3,3,0,0,2,3,3,3,3,0],
			[3,3,0,0,0,0,0,0,0,0],
			[2,0,0,0,2,0,2,2,2,2],
			[2,2,2,2,2,6,0,0,0,2],
			[3,3,0,0,0,0,0,0,5,3],
			[3,3,3,3,3,3,3,3,3,3]
		];

		</script>

	</BODY>
</HTML>
